Gesti√≥n de Lugares por Administradores
Visualizaci√≥n y Navegaci√≥n
Los administradores acceden a la lista de lugares a trav√©s de /places page.tsx:72-77 . La interfaz muestra:
Vista de lista con mapa integrado: Layout de dos columnas con mapa a la izquierda (650px) y lista scrolleable a la derecha page.tsx:117-136
Contador de lugares: Muestra el total de lugares en el sistema page.tsx:140-142
Sincronizaci√≥n mapa-lista: Al hacer clic en una tarjeta de lugar, el mapa se centra autom√°ticamente en esas coordenadas con zoom 15 page.tsx:35-38
Informaci√≥n Mostrada de Cada Lugar
Cada tarjeta de lugar muestra page.tsx:232-320 :
Nombre y tipo de lugar (üå≥ parque o ‚òï caf√©) page.tsx:235-242
Ciudad con badge de ubicaci√≥n page.tsx:244-258
Direcci√≥n completa page.tsx:262-266
Horario de apertura page.tsx:268-273
Descripci√≥n page.tsx:275-279
Foto (si est√° disponible) page.tsx:281-294
Tags categorizados page.tsx:297-320
Eliminaci√≥n de Lugares
Los administradores pueden eliminar lugares mediante el bot√≥n "üóëÔ∏è Delete" en la esquina superior derecha de cada tarjeta page.tsx:200-230 :
Confirmaci√≥n: El sistema solicita confirmaci√≥n antes de eliminar page.tsx:41-43
Eliminaci√≥n en Firestore: Llama a deletePlace(placeId) que elimina el documento de la colecci√≥n places page.tsx:46
Actualizaci√≥n de UI: Filtra el lugar eliminado del estado local sin recargar la p√°gina page.tsx:47
Feedback: Muestra alerta de confirmaci√≥n "Place deleted ‚úÖ" page.tsx:48
A√±adir Nuevos Lugares
Los administradores pueden a√±adir lugares mediante el bot√≥n "+ Add place" que redirige a /places/new page.tsx:95-110 .
El formulario de creaci√≥n (PlaceForm) incluye PlaceForm.tsx:183-388 :
Campos obligatorios:
Coordenadas: Entrada manual en formato decimal (lat, lng) o selecci√≥n por clic en mapa PlaceForm.tsx:146-173
Nombre: M√≠nimo 2 caracteres PlaceForm.tsx:184-210
Tipo de lugar: Selecci√≥n entre "üå≥ Park/Garden" o "‚òï Cafe/Restaurant" PlaceForm.tsx:235-265
Campos opcionales autocompletados:
Ciudad y Direcci√≥n: Se obtienen autom√°ticamente mediante geocodificaci√≥n inversa de Nominatim cuando se seleccionan coordenadas PlaceForm.tsx:56-81
Horario: Texto libre para especificar horarios de apertura PlaceForm.tsx:290-311
Descripci√≥n: Notas adicionales sobre el lugar PlaceForm.tsx:313-337
Tags: Lista separada por comas para categorizaci√≥n PlaceForm.tsx:339-360
Proceso de Guardado
Al enviar el formulario PlaceForm.tsx:118-141 :
Validaci√≥n: Verifica que se hayan seleccionado coordenadas PlaceForm.tsx:119-122
Autenticaci√≥n: Asegura sesi√≥n an√≥nima si no hay usuario autenticado PlaceForm.tsx:123-124
Creaci√≥n en Firestore: Llama a addPlace() que autom√°ticamente:
Genera el geohash para b√∫squedas espaciales firestore.ts:49
A√±ade timestamp del servidor firestore.ts:50
Establece status como "approved" por defecto firestore.ts:51
Reset del formulario: Limpia todos los campos tras guardado exitoso PlaceForm.tsx:136-140
---------------------------------------------
Vista Embebible del Mapa (/embed/map)
La ruta /embed/map proporciona una versi√≥n del mapa dise√±ada espec√≠ficamente para ser embebida en sitios externos mediante iframes page.tsx:15 . Es un componente cliente de React que carga din√°micamente el mapa para evitar problemas con el renderizado del servidor page.tsx:2-13 .
Inicializaci√≥n y Carga de Datos
Al cargar la p√°gina, el componente ejecuta una secuencia de inicializaci√≥n page.tsx:22-41 :
Autenticaci√≥n an√≥nima: Primero establece una sesi√≥n an√≥nima de Firebase mediante ensureAnonAuth() page.tsx:25-27
Carga de lugares: Obtiene hasta 100 lugares desde Firestore usando listLatestPlaces(100) page.tsx:29-31
Filtrado: Solo muestra lugares con status === 'approved' page.tsx:33
Layout y Estructura Visual
El layout ocupa todo el viewport (100vw x 100vh) y se divide en dos secciones page.tsx:112-119 :
Mapa (lado izquierdo) page.tsx:121-128 :
Ocupa el espacio flexible restante (flex: 1)
Usa el componente MapCanvas con altura de 100vh
Centro y zoom controlados por estado (mapCenter, mapZoom)
Muestra marcadores üåø para cada lugar
Sidebar (lado derecho) page.tsx:131-138 :
Ancho fijo de 400px
Scroll vertical para lista de lugares
Fondo oscuro (#0F0F0F) con borde izquierdo
T√≠tulo "üåø Calm Places"
Tarjetas de Lugares
Cada lugar se muestra en una tarjeta interactiva page.tsx:154-174 que incluye:
Informaci√≥n mostrada page.tsx:175-250 :
Nombre con icono de tipo (üå≥ para parques, ‚òï para caf√©s) page.tsx:178-189
Badge de ciudad con üìç (si existe) page.tsx:191-204
Direcci√≥n con üìç (si existe) page.tsx:208-216
Horario con üïê (si existe) page.tsx:219-227
Descripci√≥n (si existe) page.tsx:230-239
Tags con formato hashtag (si existen) page.tsx:242-250
Efectos hover: Al pasar el mouse, la tarjeta cambia de color y muestra un borde verde page.tsx:166-173 .
Interacci√≥n con el Mapa
Al hacer clic en una tarjeta, se activa handlePlaceClick() page.tsx:43-46 que:
Centra el mapa en las coordenadas del lugar
Hace zoom a nivel 15 para vista detallada
El componente MapCanvas recibe estos cambios y anima la transici√≥n usando flyTo de Leaflet MapCanvas.tsx:77-84 .
Estados de Carga y Error
Estado de carga page.tsx:48-78 :
Muestra un spinner animado con el color de marca (#A4CB3E)
Texto "Loading map..." en gris
Ocupa todo el viewport con fondo oscuro
Estado de error page.tsx:80-110 :
Muestra mensaje de error en rosa (#FF60A8)
Bot√≥n "Retry" para recargar la p√°gina
Dise√±o centrado en viewport completo
Uso en Iframe
Para embeber este mapa en un sitio externo:
src="https://tu-dominio.com/embed/map"
width="100%"
height="600px"
frameborder="0">
La vista est√° optimizada para este uso con:
Estilos inline para evitar conflictos con CSS del sitio padre page.tsx:113-119
Autenticaci√≥n an√≥nima autom√°tica (no requiere login) page.tsx:25-27
Tema oscuro consistente con la marca Dirty Roots page.tsx:117
-----------------------------------------------------------------
Sistema de Preguntas y Respuestas
El sistema Q&A permite a los usuarios hacer preguntas sobre lugares tranquilos y pr√°cticas de mindfulness, y a usuarios autenticados responderlas page.tsx:1-9 . Las preguntas se vuelven p√∫blicas autom√°ticamente cuando reciben una respuesta firestore.ts:95-104 .
1. Creaci√≥n de Preguntas
Formulario de Env√≠o
Los usuarios pueden crear preguntas desde dos lugares:
P√°gina principal embebible (/qa/embed/questions) page.tsx:49-87 :
Dise√±ada para iframes en sitios externos
Formulario centrado con fondo oscuro
Redirige al padre tras crear la pregunta
Componente QuestionForm QuestionForm.tsx:17-26 :
Campo obligatorio: Texto de la pregunta (m√≠nimo 5 caracteres)
Campo opcional: Contexto adicional
Validaci√≥n con Zod schema
Proceso de Guardado
Al enviar el formulario QuestionForm.tsx:20-26 :
Autenticaci√≥n: Llama a ensureAnonAuth() para establecer sesi√≥n an√≥nima
Obtenci√≥n de UID: Usa auth.currentUser?.uid o "anon" como fallback
Creaci√≥n en Firestore: Llama a addQuestion() con los datos
Estado inicial: La pregunta se crea con public: false firestore.ts:95-104
Callback: Ejecuta onCreated(id) para redirigir o actualizar UI
Importante: Las preguntas nuevas NO son p√∫blicas hasta que reciben una respuesta firestore.ts:99 .
2. Visualizaci√≥n de Preguntas
Lista de Preguntas (/qa)
La p√°gina principal de Q&A muestra todas las preguntas page.tsx:52-88 :
Inicializaci√≥n page.tsx:13-25 :
Establece autenticaci√≥n an√≥nima
Carga hasta 100 preguntas con listQuestions(100)
Ordena por fecha de creaci√≥n descendente
Cada tarjeta muestra page.tsx:114-177 :
Texto de la pregunta (negrita, 18px)
Contexto adicional (si existe)
Badge de estado:
"‚úì Answered" (verde) si tiene respuesta page.tsx:180-189
"No response" (rosa) si no tiene respuesta page.tsx:190-199
Badge "‚úì Public" si public === true page.tsx:201-211
Bot√≥n de eliminar (üóëÔ∏è) en esquina superior derecha page.tsx:133-162
Interacci√≥n: Al hacer clic en una tarjeta, navega a /qa/${id} para ver detalles page.tsx:164-167 .
3. Vista Detallada y Respuesta
P√°gina de Detalle (/qa/[id])
La vista de detalle usa un layout de dos columnas page.tsx:172-173 :
Columna izquierda (pregunta y respuesta) page.tsx:174-321 :
Tarjeta de pregunta: Muestra texto, contexto y badge de estado
Tarjeta de respuesta (si existe): Muestra texto de respuesta y referencias
Estado vac√≠o (si no hay respuesta): Emoji üí≠ con mensaje "This question still has no answer"
Columna derecha (formulario sticky) page.tsx:324-424 :
Formulario para a√±adir/modificar respuesta
Campo de texto (5 filas, obligatorio)
Campo de referencias (opcional, separadas por comas)
Bot√≥n de env√≠o din√°mico: "Post response" o "Update response"
Proceso de Respuesta
Al enviar una respuesta page.tsx:51-71 :
Validaci√≥n: Verifica que el texto no est√© vac√≠o con text.trim()
Autenticaci√≥n: Asegura sesi√≥n con ensureAnonAuth()
Obtenci√≥n de UID: Usa auth.currentUser?.uid para atribuir autor√≠a
Procesamiento de referencias: Divide por comas, limpia espacios y filtra vac√≠os page.tsx:60
Guardado: Llama a setAnswer(id, {text, references, createdBy})
Actualizaci√≥n autom√°tica: La funci√≥n setAnswer() establece public: true firestore.ts:145-149
Recarga: Actualiza la pregunta para mostrar la nueva respuesta
Salida de modo edici√≥n: Establece isEditing: false
Edici√≥n de Respuestas
Si ya existe una respuesta page.tsx:219-298 :
Modo lectura:
Muestra la respuesta en tarjeta con fondo oscuro
Bot√≥n "‚úèÔ∏è Modify" para activar edici√≥n page.tsx:232-255
Referencias mostradas como badges verdes
Modo edici√≥n page.tsx:73-82 :
Al hacer clic en "Modify", establece isEditing: true
Pre-llena el formulario con texto y referencias existentes page.tsx:39-43
Bot√≥n "Cancel" restaura valores originales
Al guardar, actualiza la respuesta manteniendo public: true
4. Eliminaci√≥n de Preguntas
Los usuarios pueden eliminar preguntas desde la lista page.tsx:27-39 :
Confirmaci√≥n: Muestra di√°logo "Are you sure you want to delete this question?"
Eliminaci√≥n: Llama a deleteQuestion(questionId) firestore.ts:120-123
Actualizaci√≥n UI: Filtra la pregunta del estado local sin recargar
Manejo de errores: Muestra alerta si falla
5. Estados de Carga
Ambas p√°ginas implementan estados de carga consistentes:
Estado de carga page.tsx:41-50 :
Spinner animado con color de marca (#A4CB3E)
Texto "Loading questions..." o "Loading question..."
Fondo oscuro (#0B0B0B)
Estado vac√≠o (lista) page.tsx:90-107 :
Emoji üí¨ grande
Mensaje "There are no questions yet"
Invitaci√≥n "Be the first to ask a question"
Pregunta no encontrada (detalle) page.tsx:108-135 :
Emoji ‚ùì
Mensaje "Question not found"
Bot√≥n para volver a /qa
Modelo de Datos
Estructura de Question
{
id: string,
text: string, // Pregunta (obligatorio)
context?: string, // Contexto adicional (opcional)
createdBy: string, // UID del creador
createdAt: Timestamp, // Fecha de creaci√≥n
public: boolean, // false hasta que se responde
answer?: { // Objeto de respuesta (opcional)
text: string,
references: string[],
createdBy: string,
createdAt: Timestamp
}
}
-------------------------------------------------------
Vista Embebible de Preguntas (/qa/embed/questions)
Prop√≥sito y Dise√±o
Esta ruta proporciona un formulario standalone para crear preguntas, optimizado para integraci√≥n en sitios externos page.tsx:2-9 . A diferencia de la vista principal /qa, esta interfaz se centra exclusivamente en la creaci√≥n de preguntas, no en su visualizaci√≥n o respuesta.
Inicializaci√≥n del Componente
El componente EmbedQuestionsPage es un componente cliente de React que implementa un patr√≥n de montaje en dos fases page.tsx:3-15 :
Fase 1 - Montaje del cliente page.tsx:12-15 :
Establece mounted: true para indicar que el componente est√° en el cliente
Llama a ensureAnonAuth() para establecer autenticaci√≥n an√≥nima de Firebase
Este patr√≥n previene problemas de hidrataci√≥n entre servidor y cliente.
Estados de Renderizado
Estado de carga (antes del montaje) page.tsx:17-46 :
Muestra un spinner animado con el color de marca (#A4CB3E)
Texto "Loading..." en gris (#B6B9BF)
Ocupa todo el viewport (100vw x 100vh) con fondo oscuro (#0B0B0B)
Animaci√≥n CSS de rotaci√≥n infinita
Estado montado (formulario activo) page.tsx:49-88 :
Layout centrado con flexbox
Tarjeta de formulario con ancho m√°ximo de 600px
Fondo oscuro (#0F0F0F) con borde sutil (#242424)
Bordes redondeados (24px) para est√©tica moderna
Estructura Visual
El formulario se presenta en una tarjeta centrada con tres secciones page.tsx:59-86 :
1. Encabezado page.tsx:67-74 :
T√≠tulo "üí¨ New question" (24px, negrita)
Color de texto principal (#F5F5F5)
2. Texto informativo page.tsx:75-81 :
Explica que "The questions will be made public once they receive an answer"
Texto secundario en gris (#B6B9BF, 14px)
Informa al usuario sobre el flujo de visibilidad
3. Formulario de pregunta page.tsx:82-85 :
Usa el componente compartido QuestionForm
Incluye callback onCreated para manejar el post-env√≠o
Componente QuestionForm
El formulario reutiliza el componente QuestionForm que implementa validaci√≥n con Zod QuestionForm.tsx:10-13 :
Campos del formulario QuestionForm.tsx:28-102 :
Pregunta (obligatorio) QuestionForm.tsx:32-71 :
Textarea de 3 filas
Validaci√≥n: m√≠nimo 5 caracteres
Placeholder: "¬øConoces sitios tranquilos en Prenzlauer Berg?"
Borde verde (#A4CB3E) al hacer focus
Contexto (opcional) QuestionForm.tsx:73-102 :
Input de texto simple
Placeholder: "Caf√© con terraza, poco ruido"
Mismo estilo visual que el campo de pregunta
Bot√≥n de env√≠o QuestionForm.tsx:104-131 :
Texto: "Publicar pregunta"
Fondo verde (#A4CB3E) con efecto hover
Ancho completo con bordes redondeados (pill shape)
Flujo de Env√≠o de Pregunta
Cuando el usuario env√≠a el formulario, se ejecuta la siguiente secuencia QuestionForm.tsx:20-26 :
Autenticaci√≥n: Llama a ensureAnonAuth() para asegurar sesi√≥n Firebase
Obtenci√≥n de UID: Usa auth.currentUser?.uid o "anon" como fallback
Creaci√≥n en Firestore: Llama a addQuestion() con:
text: Texto de la pregunta
context: Contexto opcional
createdBy: UID del usuario
Estado inicial: La pregunta se crea con public: false firestore.ts:95-103
Reset del formulario: Limpia los campos con reset()
Callback: Ejecuta onCreated(id) con el ID de la pregunta creada
Comportamiento de Redirecci√≥n
La caracter√≠stica clave de esta vista embebible es su comportamiento post-env√≠o page.tsx:82-85 :
onCreated={(id) => {
window.parent.location.href = `/qa/${id}`;
}}
Flujo de redirecci√≥n:
Tras crear la pregunta exitosamente, obtiene el ID del documento
Usa window.parent.location.href para navegar la ventana padre (no el iframe)
Redirige a /qa/${id} en la PWA principal para ver la pregunta reci√©n creada
Este patr√≥n permite que:
El iframe proporcione una interfaz ligera de env√≠o
El sitio padre mantenga control de la navegaci√≥n
El usuario vea su pregunta en contexto completo tras crearla
Uso en Iframe
Para embeber este formulario en un sitio externo:
src="https://tu-dominio.com/qa/embed/questions"
width="100%"
height="500px"
frameborder="0"
sandbox="allow-same-origin allow-scripts allow-top-navigation">
Consideraciones importantes:
Requiere sandbox="allow-top-navigation" para permitir la redirecci√≥n del padre
Los estilos son inline para evitar conflictos con CSS del sitio padre page.tsx:50-65
La autenticaci√≥n es an√≥nima, no requiere login del usuario page.tsx:14
Diferencias con la Vista Principal /qa
Caracter√≠stica /qa/embed/questions /qa
Prop√≥sito Solo crear preguntas Ver y gestionar preguntas
Layout Tarjeta centrada (600px max) Lista completa con grid
Navegaci√≥n Redirige al padre tras crear Navegaci√≥n interna
Visualizaci√≥n No muestra preguntas existentes Lista todas las preguntas
Eliminaci√≥n No disponible Bot√≥n üóëÔ∏è en cada tarjeta
Respuestas No disponible Navega a /qa/[id]
-------------------------------------------------------------
Sistema de Sesiones en Vivo (/live)
El componente LiveSessionsPage es una interfaz administrativa protegida que permite a usuarios autenticados con email gestionar sesiones en vivo de YouTube. Requiere autenticaci√≥n no an√≥nima mediante el componente ProtectedRoute.
Inicializaci√≥n y Carga de Datos
El componente implementa un patr√≥n de montaje en dos fases similar a otros componentes embebibles:
Fase 1 - Montaje del cliente:
Establece mounted: true para indicar renderizado en cliente
Llama a loadSessions() que ejecuta listLiveSessions(50) para obtener hasta 50 sesiones desde Firestore
Ordena las sesiones por fecha ascendente usando date.toDate().getTime()
Protecci√≥n de ruta: El componente completo est√° envuelto en , que verifica que el usuario est√© autenticado con email (no an√≥nimo).
Modelo de Datos de Sesi√≥n
Bas√°ndome en el c√≥digo, las sesiones tienen la siguiente estructura:
{
id?: string,
title: string, // T√≠tulo de la sesi√≥n
description?: string, // Descripci√≥n opcional
date: Timestamp, // Fecha/hora de la sesi√≥n
youtubeLink: string, // URL de YouTube Live
createdBy: string, // UID del creador
status?: "live" | "ended" // Estado manual de la sesi√≥n
}
Creaci√≥n de Sesiones
Formulario de Creaci√≥n
El formulario se muestra/oculta mediante el bot√≥n "+ New Session" que alterna showCreateForm. Incluye:
Campos obligatorios:
T√≠tulo (title): Input de texto con placeholder "e.g., Live Q&A ‚Äî Winter Reset"
Fecha (date): Input tipo date para selecci√≥n de fecha
Hora (time): Input tipo time para selecci√≥n de hora
YouTube Link (youtubeLink): Input tipo url con validaci√≥n de formato
Campo opcional:
Descripci√≥n (description): Textarea de 4 filas para detalles adicionales
Proceso de Guardado
Al enviar el formulario mediante handleCreateSession():
Validaci√≥n de campos: Verifica que t√≠tulo, fecha, hora y YouTube link no est√©n vac√≠os
Verificaci√≥n de autenticaci√≥n: Comprueba que auth.currentUser exista y NO sea an√≥nimo (!user.isAnonymous)
Conversi√≥n de fecha: Combina date y time en un objeto Date y lo convierte a Timestamp.fromDate(dateTime)
Creaci√≥n en Firestore: Llama a addLiveSession() con el objeto de sesi√≥n
Reset del formulario: Limpia todos los campos y oculta el formulario
Recarga de datos: Ejecuta loadSessions() para actualizar la lista
Feedback: Muestra alerta "‚úÖ Session created successfully!"
Importante: Si el usuario es an√≥nimo, redirige a /auth con mensaje de error.
Visualizaci√≥n de Sesiones
Lista de Sesiones
Cada sesi√≥n se muestra en una tarjeta con:
Informaci√≥n principal:
T√≠tulo (20px, negrita, con padding derecho de 200px para botones)
Descripci√≥n (si existe, 14px, color gris)
Fecha formateada: "Month Day, Year" (e.g., "January 19, 2025")
Hora formateada: "HH:MM AM/PM" (e.g., "07:00 PM")
YouTube Link: Badge clickeable que abre en nueva pesta√±a
Sistema de Estados
Las sesiones tienen tres estados posibles determinados por l√≥gica temporal y campo status:
1. LIVE NOW (üî¥):
Condici√≥n: session.status === "live"
Badge verde (#A4CB3E) con animaci√≥n de pulso
Prioridad m√°xima sobre otros estados
2. Upcoming:
Condici√≥n: sessionDate >= now && !isLive
Badge rosa (#FF60A8) con fondo transparente
Indica sesiones futuras
3. Past:
Condici√≥n: sessionDate < now && !isLive
Badge gris (#757575)
Sesiones que ya pasaron
4. Ended:
Condici√≥n: session.status === "ended"
Badge gris (#757575)
Estado manual para sesiones finalizadas
Eliminaci√≥n de Sesiones
El bot√≥n "üóëÔ∏è Delete" en la esquina superior derecha ejecuta handleDeleteSession():
Confirmaci√≥n: Muestra di√°logo "Are you sure you want to delete this session?"
Eliminaci√≥n: Llama a deleteLiveSession(sessionId) que elimina el documento de Firestore
Actualizaci√≥n UI: Filtra la sesi√≥n del estado local con sessions.filter(s => s.id !== sessionId)
Feedback: Muestra alerta "‚úÖ Session deleted"
Sistema de Exportaci√≥n de Emails
Funcionalidad de Reservas
El bot√≥n "üìß Export Emails" ejecuta handleExportEmails(session), que implementa un modal personalizado con manipulaci√≥n directa del DOM:
Flujo de exportaci√≥n:
Verificaci√≥n de autenticaci√≥n: Comprueba que el usuario tenga email (no an√≥nimo)
Carga de reservas: Llama a listSeatReservations(session.id) para obtener todas las reservas de esa sesi√≥n
Preparaci√≥n de datos:
sessionTitle: T√≠tulo de la sesi√≥n
youtubeLink: URL de YouTube
emailList: Emails unidos con \n (uno por l√≠nea)
totalReservations: Contador de reservas
Modal de Exportaci√≥n
El modal se crea din√°micamente con document.createElement('div') y contiene:
Estructura del modal:
Header: T√≠tulo "Export Session Data" con bot√≥n √ó para cerrar
Contador: "Total Reservations: X" en verde
Tres secciones con campos readonly:
Session Title: Input con t√≠tulo + bot√≥n "üìã Copy"
YouTube Link: Input con URL + bot√≥n "üìã Copy"
Email List: Textarea con emails (8 filas) + bot√≥n "üìã Copy"
Bot√≥n Close: Cierra el modal
Funcionalidad de Copia
Cada bot√≥n "üìã Copy" ejecuta copyToClipboard(text, buttonId):
Copia al portapapeles: Usa navigator.clipboard.writeText(text)
Feedback visual: Cambia el bot√≥n a "‚úÖ Copied!" con fondo verde durante 2 segundos
Restauraci√≥n: Vuelve al estado original tras el timeout
Efectos hover: Los botones cambian de transparente a verde s√≥lido al pasar el mouse.
Cierre del Modal
El modal se puede cerrar de tres formas:
Bot√≥n √ó en la esquina superior derecha
Bot√≥n "Close" al final del modal
Click fuera del modal (en el overlay oscuro)
Estados de Carga
Estado inicial (antes de montaje):
Spinner animado verde (#A4CB3E)
Texto "Loading..."
Ocupa todo el viewport (100vw x 100vh)
Estado de carga de sesiones:
Spinner dentro de tarjeta con borde
Texto "Loading sessions..."
Estado vac√≠o (sin sesiones):
Emoji üìÖ grande (64px)
Mensaje "No sessions yet"
Submensaje "Create your first live session"
Integraci√≥n con Firestore
El sistema depende de cuatro funciones de Firestore que deben estar implementadas en pwa/src/lib/firestore.ts:
listLiveSessions(limit: number): Obtiene sesiones ordenadas por fecha
addLiveSession(data: LiveSession): Crea nueva sesi√≥n
deleteLiveSession(id: string): Elimina sesi√≥n por ID
listSeatReservations(sessionId: string): Obtiene reservas de una sesi√≥n
Nota importante: Estas funciones NO est√°n visibles en el c√≥digo proporcionado, por lo que asumo que deben implementarse en firestore.ts siguiendo el mismo patr√≥n que listQuestions(), addQuestion(), etc.
Modelo de Datos de Reserva
Bas√°ndome en el uso de listSeatReservations(), las reservas deben tener al menos:
{
id?: string,
sessionId: string, // ID de la sesi√≥n
email: string, // Email del usuario reservado
createdAt: Timestamp // Fecha de reserva
}
Diferencias con Otros Sistemas
Caracter√≠stica /live /qa /places
Autenticaci√≥n Email obligatorio An√≥nima permitida An√≥nima permitida
Protecci√≥n ProtectedRoute Sin protecci√≥n Sin protecci√≥n
Creaci√≥n Formulario inline Componente separado Ruta /places/new
Exportaci√≥n Modal con emails No disponible No disponible
Estados 4 estados temporales 2 estados (answered/not) 1 estado (approved)
Ordenamiento Por fecha ascendente Por fecha descendente Sin orden espec√≠fico
---------------------------------------------
Vista Embebible de Sesiones en Vivo (/live/embed)
El componente EmbedLiveSessionsPage es una interfaz p√∫blica de solo lectura y reserva que contrasta con la vista administrativa /live. Usa autenticaci√≥n an√≥nima y permite a cualquier usuario reservar un asiento proporcionando solo su email.
Inicializaci√≥n y Carga de Datos
El componente implementa un patr√≥n de montaje en dos fases:
Fase 1 - Montaje del cliente:
Establece mounted: true para indicar renderizado en cliente
Llama a ensureAnonAuth() para establecer autenticaci√≥n an√≥nima de Firebase
Ejecuta loadSessions() para cargar las sesiones
Fase 2 - Carga y filtrado de sesiones:
Obtiene hasta 50 sesiones con listLiveSessions(50)
Filtra solo sesiones activas: status === "upcoming" || status === "live"
Ordena por fecha ascendente: Sesiones m√°s pr√≥ximas primero usando date.toMillis()
Diferencia clave con /live: La vista administrativa muestra TODAS las sesiones (incluyendo pasadas y finalizadas), mientras que esta vista embebible solo muestra sesiones activas.
Layout y Estructura Visual
El layout ocupa todo el espacio disponible con scroll vertical:
Contenedor principal:
width: 100%, height: 100%
Fondo oscuro (#0B0B0B)
Flexbox con direcci√≥n columna
Overflow hidden en el contenedor, scroll en el contenido
√Årea de contenido:
flex: 1 para ocupar espacio disponible
overflowY: auto para scroll vertical
Padding de 32px
Secciones de la Interfaz
1. Header Centrado
T√≠tulo: "üéôÔ∏è Live Q&A Sessions" (32px, negrita)
Subt√≠tulo: "Join our seasonal live sessions with Adam" (16px, gris)
Centrado con textAlign: 'center'
2. Mensaje de √âxito (Condicional)
Aparece tras reservar exitosamente un asiento:
Fondo verde transl√∫cido (rgba(164, 203, 62, 0.1))
Borde verde (#A4CB3E)
Muestra el YouTube link si est√° disponible
Auto-desaparece tras 5 segundos usando setTimeout()
Dos variantes de mensaje:
Con link: "‚úÖ Seat reserved! YouTube link: {link}"
Sin link: "‚úÖ Seat reserved! You'll receive the YouTube link before the session."
3. Lista de Sesiones
Cada sesi√≥n se muestra en una tarjeta con informaci√≥n completa:
Informaci√≥n mostrada:
T√≠tulo (24px, negrita, #F5F5F5)
Descripci√≥n (16px, gris, line-height 1.6)
Fecha formateada: "Weekday, Month Day, Year" (e.g., "Monday, January 19, 2025")
Hora formateada: "HH:MM AM/PM" con emojis üìÖ y üïê
Badge "LIVE NOW" (si status === "live"):
Posici√≥n absoluta en esquina superior derecha
Fondo verde (#A4CB3E) con texto negro
Punto pulsante animado (8px, animaci√≥n CSS pulse)
Borde de tarjeta cambia a 2px verde cuando est√° en vivo
Sistema de Reserva de Asientos
Estados de Interacci√≥n
El sistema tiene dos estados controlados por selectedSessionId:
Estado 1 - Bot√≥n de Reserva (cuando selectedSessionId !== session.id):
Bot√≥n de ancho completo (width: 100%)
Estilo din√°mico seg√∫n estado:
Si isLive: Fondo verde (#A4CB3E), texto negro, sin borde
Si upcoming: Fondo transparente, texto rosa (#FF60A8), borde rosa
Texto din√°mico:
Si isLive: "üé• Join Live Session"
Si upcoming: "üíå Save Your Seat"
Efectos hover diferentes seg√∫n estado
Estado 2 - Formulario de Email (cuando selectedSessionId === session.id):
Muestra tres elementos en flexbox con gap de 12px:
Input de email:
flex: 1 con minWidth: 200px para responsividad
Placeholder: "your@email.com"
Borde verde (#A4CB3E) al hacer focus
Deshabilitado durante env√≠o
Bot√≥n "Confirm":
Fondo verde (#A4CB3E) cuando email v√°lido
Fondo gris (#2A2A2A) cuando email vac√≠o o enviando
Texto: "Saving..." durante env√≠o, "Confirm" normalmente
Cursor not-allowed cuando deshabilitado
Bot√≥n "Cancel":
Fondo transparente con borde gris
Limpia el email y cierra el formulario
Deshabilitado durante env√≠o
Proceso de Reserva
Al hacer clic en "Confirm", se ejecuta handleSaveSeat(sessionId):
Validaciones:
Email no vac√≠o: Verifica email.trim()
Formato de email v√°lido: Usa regex /^[^\s@]+@[^\s@]+\.[^\s@]+$/
Flujo de guardado:
Establece submitting: true para deshabilitar controles
Llama a addSeatReservation() con:
sessionId: ID de la sesi√≥n
email: Email limpio con trim()
createdBy: Siempre "anonymous" (no usa UID de Firebase)
Busca la sesi√≥n en el array local para obtener youtubeLink
Establece mensaje de √©xito con o sin link
Limpia el email y cierra el formulario
Auto-limpia el mensaje tras 5 segundos con setTimeout()
Manejo de errores:
Muestra alert gen√©rico: "Error reserving seat. Please try again."
No proporciona detalles espec√≠ficos del error al usuario
Estados de Carga y Vac√≠o
Estado de Carga
Muestra mientras !mounted || loading:
Spinner animado verde (#A4CB3E) de 48px
Texto "Loading sessions..." en gris
Fondo oscuro (#0B0B0B)
Animaci√≥n CSS spin de rotaci√≥n infinita
Estado Vac√≠o
Muestra cuando sessions.length === 0:
Emoji üìÖ grande (64px)
Mensaje principal: "No upcoming sessions" (18px, gris)
Submensaje: "Check back soon for new live Q&A dates" (14px, gris m√°s oscuro)
Tarjeta con fondo #0F0F0F y borde #242424
Modelo de Datos de Reserva
Bas√°ndome en el uso de addSeatReservation(), las reservas se crean con:
{
sessionId: string, // ID de la sesi√≥n
email: string, // Email del usuario (trimmed)
createdBy: "anonymous" // Siempre string literal "anonymous"
}
Nota importante: A diferencia de otros sistemas que usan auth.currentUser?.uid, este sistema usa el string literal "anonymous" para todas las reservas. Esto significa que no hay trazabilidad de usuarios individuales, solo emails.
Uso en Iframe
Para embeber esta vista en un sitio externo:
src="https://tu-dominio.com/live/embed"
width="100%"
height="600px"
frameborder="0"
style="border-radius: 24px;">
Caracter√≠sticas de integraci√≥n:
Estilos inline para evitar conflictos con CSS del sitio padre
Autenticaci√≥n an√≥nima autom√°tica (no requiere login)
No redirige la ventana padre (a diferencia de /qa/embed/questions)
Tema oscuro consistente con la marca Dirty Roots
Diferencias con la Vista Administrativa /live
Caracter√≠stica /live/embed /live
Autenticaci√≥n An√≥nima (autom√°tica) Email obligatorio (ProtectedRoute)
Sesiones mostradas Solo upcoming/live Todas (incluyendo pasadas)
Funcionalidad principal Reservar asientos Crear/gestionar sesiones
Exportaci√≥n de emails No disponible Modal con copy buttons
Eliminaci√≥n de sesiones No disponible Bot√≥n üóëÔ∏è Delete
Creaci√≥n de sesiones No disponible Formulario inline
Ordenamiento Ascendente (pr√≥ximas primero) Ascendente (pr√≥ximas primero)
Feedback de reserva Mensaje temporal con link N/A
Integraci√≥n con Firestore
El sistema depende de dos funciones de Firestore:
listLiveSessions(limit: number): Obtiene sesiones (compartida con /live)
addSeatReservation(data: SeatReservation): Crea nueva reserva
Nota: Estas funciones deben estar implementadas en pwa/src/lib/firestore.ts siguiendo el mismo patr√≥n que otras funciones del sistema.

-----------------------------------------------------

Vista del Administrador (/growslowlyshop/page.tsx) 
Autenticaci√≥n y Protecci√≥n 
La p√°gina administrativa est√° protegida mediante el componente ProtectedRoute, que requiere autenticaci√≥n de Firebase para acceder. page.tsx:746-752

Funcionalidades Principales 
1. Crear Productos

El administrador completa un formulario con validaci√≥n mediante Zod que requiere: page.tsx:15-21

name: nombre del producto (m√≠nimo 2 caracteres)
label: etiqueta descriptiva
price: precio positivo
link: URL v√°lida del producto
imageBase64: imagen comprimida en base64
2. Compresi√≥n de Im√°genes

El sistema comprime autom√°ticamente las im√°genes subidas a m√°ximo 400KB usando browser-image-compression, redimension√°ndolas a 600px y convirti√©ndolas a JPEG con 70% de calidad. page.tsx:63-105 Si la imagen excede 900KB despu√©s de la compresi√≥n, se rechaza. page.tsx:91-94

3. Editar Productos

Al hacer clic en el bot√≥n "‚úèÔ∏è Edit" de un producto, el formulario se pre-rellena con los datos existentes y cambia a modo edici√≥n. page.tsx:107-115 page.tsx:641-658 El bot√≥n de submit cambia a "Update Product". page.tsx:570

4. Eliminar Productos

El bot√≥n "üóëÔ∏è Delete" solicita confirmaci√≥n antes de eliminar permanentemente un producto de Firestore. page.tsx:123-136 page.tsx:659-677

5. Flujo de Guardado

El formulario detecta si est√° en modo edici√≥n o creaci√≥n: page.tsx:146-180

Modo edici√≥n: llama a updateProduct() y actualiza el estado local
Modo creaci√≥n: llama a addProduct() con el uid del usuario autenticado y recarga la lista completa
Visualizaci√≥n de Productos 
Los productos se muestran en una cuadr√≠cula con tarjetas que incluyen imagen de fondo, nombre, label, precio y botones de edici√≥n/eliminaci√≥n. page.tsx:636-695

Vista del Usuario (/growslowlyshop/embed/page.tsx) 
Autenticaci√≥n An√≥nima 
El embed utiliza ensureAnonAuth() para establecer una sesi√≥n an√≥nima de Firebase sin requerir registro, permitiendo acceso inmediato a los datos. page.tsx:20-27

Patr√≥n de Ciclo de Vida 
Implementa un patr√≥n de dos fases para evitar problemas de hidrataci√≥n en SSR: page.tsx:13-28

Fase 1: Establece mounted = true
Fase 2: Solo cuando mounted === true, ejecuta autenticaci√≥n y carga de datos
Carrusel Horizontal 
Los productos se muestran en un carrusel horizontal con scroll suave: page.tsx:91-108

scrollSnapType: 'x mandatory' para scroll card-by-card
Scrollbar oculto mediante CSS page.tsx:228-238
Responsive: en m√≥vil (<768px) las tarjetas ocupan calc(100% - 32px) page.tsx:254-275
Estructura de Tarjetas 
Cada tarjeta de producto es un enlace clickeable (<a>) que abre el producto en una nueva pesta√±a: page.tsx:110-121

Imagen de fondo: 338.75px de altura con backgroundImage usando product.imageBase64 page.tsx:136-143
Label: texto gris en la esquina superior izquierda
Precio: formato "‚Ç¨X.XX" en la esquina superior derecha
Nombre: texto blanco en negrita en la parte inferior
Carga de Datos 
Obtiene hasta 50 productos mediante listProducts(50) en una sola llamada. page.tsx:30-39 No hay actualizaci√≥n autom√°tica; los datos se cargan una vez al montar el componente.

Estados de UI 
Estado de carga: Muestra un spinner verde (#A4CB3E) centrado con animaci√≥n de rotaci√≥n. page.tsx:41-66

Estado vac√≠o: Si no hay productos, muestra un emoji üõçÔ∏è con el mensaje "No products available yet." page.tsx:77-89

Integraci√≥n del Embed 
El c√≥digo HTML que proporcionaste muestra c√≥mo se integra el embed en una p√°gina externa. El iframe apunta a https://dirty-roots.vercel.app/growslowlyshop/embed con altura de 600px y estilos CSS adicionales para ocultar scrollbars en todos los navegadores.

El embed es completamente de solo lectura para usuarios finales - no pueden agregar, editar o eliminar productos, solo visualizarlos y hacer clic en los enlaces externos.

Notes 
El flujo completo es: el admin crea/edita productos en /growslowlyshop/page.tsx ‚Üí los datos se guardan en Firestore mediante addProduct() o updateProduct() ‚Üí el embed en /growslowlyshop/embed/page.tsx los lee mediante listProducts() y los muestra en el carrusel. Ambas interfaces comparten las mismas funciones de Firestore pero con diferentes niveles de acceso (escritura vs solo lectura).

--------------------------------------------------------

Vista del Administrador (/seasonal-toolkit/page.tsx) 
Autenticaci√≥n y Protecci√≥n 
La p√°gina administrativa est√° protegida mediante ProtectedRoute, requiriendo autenticaci√≥n de Firebase para acceder. page.tsx:854-860

Funcionalidades Principales 
1. Crear Toolkits

El administrador completa un formulario con validaci√≥n mediante Zod que requiere: page.tsx:20-33

season: estaci√≥n (winter, spring, summer, autumn)
title: t√≠tulo del toolkit (m√≠nimo 2 caracteres)
description: descripci√≥n corta (m√≠nimo 10 caracteres)
calmReminder: frase filos√≥fica LITFA (m√≠nimo 5 caracteres)
checklist: items de checklist (uno por l√≠nea, m√≠nimo 10 caracteres)
lightMapDescription: descripci√≥n del mapa de luz (m√≠nimo 10 caracteres)
microGuide: gu√≠a de cuidado (m√≠nimo 20 caracteres)
checklistPdf, posterPdf, guidePdf: URLs opcionales de PDFs descargables
activeFromDate, activeToDate: per√≠odo de actividad del toolkit
2. Editar Toolkits

Al hacer clic en "‚úèÔ∏è Edit", el formulario se pre-rellena con los datos existentes del toolkit. page.tsx:79-94 El checklist (array) se convierte en texto con saltos de l√≠nea para edici√≥n, y las fechas Timestamp se convierten a formato ISO para los inputs de tipo date. page.tsx:85-92

3. Eliminar Toolkits

El bot√≥n "üóëÔ∏è Delete" solicita confirmaci√≥n antes de eliminar permanentemente un toolkit de Firestore. page.tsx:102-115

4. Flujo de Guardado

El formulario detecta si est√° en modo edici√≥n o creaci√≥n: page.tsx:117-173

Modo edici√≥n: llama a updateSeasonalToolkit() y actualiza el estado local sin recargar
Modo creaci√≥n: llama a addSeasonalToolkit() con el uid del usuario autenticado y recarga la lista completa
El checklist se procesa dividiendo el texto por saltos de l√≠nea y filtrando l√≠neas vac√≠as. page.tsx:136 Los PDFs opcionales solo se incluyen si tienen valor. page.tsx:126-129

Visualizaci√≥n de Toolkits 
Los toolkits se muestran en una lista vertical con tarjetas que incluyen: page.tsx:700-841

Badge de estaci√≥n con emoji (‚ùÑÔ∏è, üå±, ‚òÄÔ∏è, üçÇ)
T√≠tulo y descripci√≥n
Calm reminder en caja destacada
Per√≠odo activo con fechas
Botones de edici√≥n y eliminaci√≥n
Vista del Usuario (/seasonal-toolkit/embed/page.tsx) 
Autenticaci√≥n An√≥nima 
El embed utiliza ensureAnonAuth() para establecer una sesi√≥n an√≥nima de Firebase sin requerir registro. page.tsx:38

Patr√≥n de Ciclo de Vida 
Implementa el mismo patr√≥n de dos fases que el shop para evitar problemas de hidrataci√≥n en SSR: page.tsx:27-45

Fase 1: Establece mounted = true
Fase 2: Solo cuando mounted === true, ejecuta autenticaci√≥n, carga de datos y solicitud de geolocalizaci√≥n
Filtrado Temporal 
A diferencia del shop, este embed filtra los toolkits para mostrar solo los activos en el momento actual: page.tsx:76-92

const now = new Date();  
const activeToolkits = allToolkits.filter(t => {  
  const from = t.activeFrom.toDate();  
  const to = t.activeTo.toDate();  
  return now >= from && now <= to;  
});
Geolocalizaci√≥n y Mapa de Luz Solar 
Solicitud de ubicaci√≥n: Al montar el componente, solicita la ubicaci√≥n del usuario mediante navigator.geolocation.getCurrentPosition(). page.tsx:95-115 Si se deniega o no est√° disponible, usa una ubicaci√≥n por defecto (50.0, 10.0).

C√°lculo de posici√≥n solar: Implementa un algoritmo simplificado que calcula la posici√≥n del sol bas√°ndose en la hora actual: page.tsx:54-74

Convierte la hora actual a decimal (hora + minutos/60)
Calcula el azimut asumiendo movimiento este-oeste (90¬∞ + ((hora - 6) / 12) * 180¬∞)
Proyecta la posici√≥n del sol a ~0.5km de distancia del usuario
Bot√≥n de recentrado: Permite al usuario volver a centrar el mapa en su ubicaci√≥n, incrementando mapKey para forzar el re-render del componente MapCanvas. page.tsx:117-124

Cuadr√≠cula de Toolkits 
Los toolkits activos se muestran en una cuadr√≠cula responsive (repeat(auto-fit, minmax(300px, 1fr))) con tarjetas clickeables que abren un drawer con el contenido completo. page.tsx:206-233

Drawer de Contenido Detallado 
Al hacer clic en un toolkit, se abre un drawer desde abajo con animaci√≥n translateY que muestra: page.tsx:332-361

1. Header: Emoji de estaci√≥n + t√≠tulo + descripci√≥n page.tsx:366-393

2. Calm Reminder: Frase en caja destacada con color verde (#A4CB3E) e it√°lica page.tsx:395-412

3. Checklist: Lista de items con bullets, cada uno en su propia caja page.tsx:414-444

4. Mapa Interactivo de Luz: Componente MapCanvas con overlays fijos: page.tsx:486-601

Marcador de usuario (üìç): Centrado en 50%, 50%
Marcador de sol (‚òÄÔ∏è): En 20%, 20% con animaci√≥n de pulso
Info overlay: Muestra hora actual y patr√≥n de luz estacional
Bot√≥n de recentrado (üéØ): Bot√≥n flotante verde para volver a la ubicaci√≥n del usuario
5. Care Guide: Texto de gu√≠a con whiteSpace: 'pre-wrap' para preservar saltos de l√≠nea page.tsx:639-662

6. Downloadables: Grid de enlaces a PDFs (checklist, poster, guide) si est√°n disponibles page.tsx:664-721

Estados de UI 
Estado de carga: Spinner verde (#A4CB3E) con mensaje "Loading seasonal toolkit..." page.tsx:138-163

Estado vac√≠o: Si no hay toolkits activos, muestra "No active seasonal toolkit at the moment. Check back soon!" page.tsx:196-205

Sin ubicaci√≥n: Si no se obtiene la ubicaci√≥n, muestra un placeholder con mensaje "üìç Enable location access to see your personalized light map" page.tsx:602-622

Integraci√≥n del Embed 
El embed se integrar√≠a de forma similar al shop, usando un iframe que apunte a /seasonal-toolkit/embed. La diferencia clave es que este embed requiere permisos de geolocalizaci√≥n para funcionar completamente, por lo que el iframe deber√≠a incluir allow="geolocation".

Notes 
El flujo completo es: el admin crea/edita toolkits en /seasonal-toolkit/page.tsx ‚Üí los datos se guardan en Firestore mediante addSeasonalToolkit() o updateSeasonalToolkit() ‚Üí el embed en /seasonal-toolkit/embed/page.tsx los lee mediante listSeasonalToolkits(), filtra por fechas activas, y los muestra con mapas interactivos. A diferencia del shop (solo lectura), este embed tiene interactividad mediante geolocalizaci√≥n y mapas din√°micos, pero sigue siendo de solo lectura en cuanto a los datos del toolkit.